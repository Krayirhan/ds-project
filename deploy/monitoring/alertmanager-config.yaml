apiVersion: v1
kind: ConfigMap
metadata:
  name: ds-project-alertmanager-config
  namespace: ds-project
data:
  alertmanager.yml: |
    global:
      resolve_timeout: 5m

    route:
      receiver: default-receiver
      group_by: ["alertname", "service"]
      group_wait: 30s
      group_interval: 5m
      repeat_interval: 1h
      routes:
        - matchers:
            - severity="critical"
          receiver: pagerduty-critical
        - matchers:
            - severity="warning"
          receiver: slack-warnings

    receivers:
      - name: default-receiver
        webhook_configs:
          - url: "http://alert-router.ds-project.svc.cluster.local/default"

      - name: slack-warnings
        slack_configs:
          - api_url: "${SLACK_WEBHOOK_URL}"
            channel: "#ds-alerts"
            title: "[DS Project] {{ .CommonAnnotations.summary }}"
            text: "{{ .CommonAnnotations.description }}"

      - name: pagerduty-critical
        pagerduty_configs:
          - routing_key: "${PAGERDUTY_ROUTING_KEY}"
            description: "{{ .CommonAnnotations.summary }}"
